<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diários de Mystic Falls</title>

    <link rel="stylesheet" href="css/styleDiario.css">

</head>

<body>

    <div class="sidebar">
        <div class="sidebarMarrom">
            <div class="sidebar-header">
                <img class="imagemPerfil" src="assets/paginaDiario/fotoPerfil.png">
                <p id="nomeUsuario">Olá, </p>
            </div>
        </div>

        <div class="navegacao">
            <button>
                <span>
                    <img src="assets/paginaDiario/simboloMetrica.png">
                    <span onclick="telaMetricas()"> Métricas </span>
                </span>
            </button>

            <button>
                <span>
                    <img src="assets/paginaDiario/quiz.png">
                    <span onclick="telaQuiz()"> Quiz </span>
                </span>
            </button>

            <button>
                <span>
                    <img src="assets/paginaDiario/diario.png">
                    <span onclick=""> Diário </span>
                </span>
            </button>

            <div class="deslogar">
                <div class="caixaDeslogar">
                    <span onclick="telaSair()">SAIR</span>
                </div>
            </div>

        </div>

    </div>

    <main class="main">

        <div class="barraBoasVindas">
            <div class="boxTexto">
                <span> MEU DIÁRIO ONLINE </span>
            </div>
        </div>

        <div class="BoxNovaEntrada">
            <div class="caixaNovaEntrada">
                <div class="boxTituloNovaEntrada">
                    <span> NOVA ENTRADA</span>
                </div>


                <div>
                    <div class="tituloDiario">
                        <span>Insira um título:</span> <br>
                        <input id="input_tituloDiario">
                    </div>

                    <div class="caixaConteudo">
                        <label for="conteudoDiario" id="titDiario">Escreva aqui seus pensamentos:</label>
                        <textarea id="conteudoDiario" name="conteudoDiario" rows="12" cols="60"
                            style="resize: both;"></textarea>
                    </div>

                    <div class="caixinhaBotao">
                        <div class="boxBotao">
                            <button>
                                <span onclick="editar()">EDITAR</span>
                            </button>
                        </div>

                        <div class="boxBotao">
                            <button>
                                <span onclick="salvar()">SALVAR</span>
                            </button>
                        </div>

                        <div class="boxBotao">
                            <button>
                                <span onclick="excluir()">EXCLUIR</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <div class="boxDiariosAntigos">
            <div class="caixaDiariosAntigos">
                <div class="boxTituloNovaEntrada">
                    <span> DIÁRIOS ANTIGOS</span>
                </div>
                <div class="entradasAntigas">
                    <div class="linhaEntradasAntigas">
                        <span id="linha4" onclick="procurar4()">Entrada 4</span>
                    </div>
                    <div class="linhaEntradasAntigas">
                        <span id="linha3" onclick="procurar3()" class="tituloDasUltimas">Entrada 3</span>
                    </div>
                    <div class="linhaEntradasAntigas">
                        <span id="linha2" onclick="procurar2()">Entrada 2</span>
                    </div>
                    <div class="linhaEntradasAntigas">
                        <span id="linha1" onclick="procurar1()">Entrada 1</span>
                    </div>
                </div>
            </div>
        </div>

        <br><br><br>

    </main>
    </div>

</body>

<script>

    var nome = sessionStorage.NOME_USUARIO;
    nomeUsuario.innerHTML += nome;

    // Puxando o id do usuario da sessionStorage que declarei no login.html. Quando ele se loga, salva os dados que vieram do banco na sessionStorage 
    var idUsuario = sessionStorage.ID_USUARIO;

    window.onload = function buscarUltimosQuatro() { // carregar sempre quando a pagina recarregar
        fetch(`diarios/ultimos/${idUsuario}`, { // diarios = diarios.js 
            method: 'GET'
        })

            .then(function (resposta) {
                console.log("resposta:", resposta);

                if (resposta.ok) {
                    resposta.json().then((diarios) => {
                        sessionStorage.DIARIOS = JSON.stringify(diarios)
                    });

                } else {
                    throw "Houve um erro ao tentar buscar os diários!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);

            });

    }

    var diarioServer = JSON.parse(sessionStorage.DIARIOS);

    linha4.innerHTML = diarioServer[0].Titulo;
    linha3.innerHTML = diarioServer[1].Titulo;
    linha2.innerHTML = diarioServer[2].Titulo;
    linha1.innerHTML = diarioServer[3].Titulo;

    function procurar4() {
        input_tituloDiario.value = diarioServer[0].Titulo;
        conteudoDiario.value = diarioServer[0].Conteudo;

    }

    function procurar3() {
        input_tituloDiario.value = diarioServer[1].Titulo;
        conteudoDiario.value = diarioServer[1].Conteudo;

    }

    function procurar2() {
        input_tituloDiario.value = diarioServer[2].Titulo;
        conteudoDiario.value = diarioServer[2].Conteudo;

    }
    function procurar1() {
        input_tituloDiario.value = diarioServer[3].Titulo;
        conteudoDiario.value = diarioServer[3].Conteudo;

    }


    function salvar() {
        var tituloVar = input_tituloDiario.value;
        var conteudoVar = conteudoDiario.value;

        fetch("diarios/criar", {
            method: 'POST',
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                titulo: tituloVar,
                conteudo: conteudoVar,
                fkUsuario: idUsuario
            }),
        })

            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    cardErro.style.display = "block";

                    mensagem_erro.innerHTML =
                        "Diário salvo com sucesso!";

                    setTimeout(() => {
                        window.location = "diario.html";
                    }, "2000");


                } else {
                    throw "Houve um erro ao tentar salvar o diário!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);

            });

        return false;

    }

    function telaMetricas() {
        window.location.href = "dashboard.html"
    }

    function telaQuiz() {
        window.location.href = "quiz.html"
    }

    function telaSair() {
        window.location.href = "index.html"
    }
</script>

</html>